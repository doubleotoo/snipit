{% extends "base.html" %}{% block title %}Snippet Upload{% end %}{% block head %}<script src="{{ static_url('js/codemirror.js') }}"></script>{% end %}{% block body %}<div align="center" style="padding-top:10px;"><h1 class="header">[Name Pending]</h1></div><div id="form_container"><form id="editor_form" method="post" enctype="multipart/form-data" action="/paste"><div id="code_container" class="code_container"><textarea name="body" id="codebox"></textarea></div><input id="uploaded_file_name" type="hidden" name="name" value="None"/>{{ xsrf_form_html() }}</form></div><div align="center" style="padding-top: 2em;"><div id="magic"><form id="file_upload" class="file_upload blue" action="/file_upload" method="POST" enctype="multipart/form-data"><input type="file" name="file" multiple><button>Upload</button><div id="upload_button">Upload</div>{{ xsrf_form_html() }}</form></div><table style="display:none" id="files"></table></div></div><script type="text/javascript"> 
(function(f){var n,m,p=function(f,i){var b=0;this.complete=function(){b+=1;b===i&&f()}};n=function(e){var i=this,b,k,a={namespace:"file_upload",uploadFormFilter:function(){return!0},fileInputFilter:function(){return!0},cssClass:"file_upload",dragDropSupport:!0,dropZone:e,url:function(c){return c.attr("action")},method:function(c){return c.attr("method")},fieldName:function(c){return c.attr("name")},formData:function(c){return c.serializeArray()},multipart:!0,multiFileRequest:!1,withCredentials:!1,
forceIframeUpload:!1},j={},l={},C=/^http(s)?:\/\//,q,d=function(){return typeof XMLHttpRequest!=="undefined"&&typeof File!=="undefined"&&(!a.multipart||typeof FormData!=="undefined"||typeof FileReader!=="undefined")},u=function(){if(a.dragDropSupport)typeof a.onDocumentDragEnter==="function"&&(j["dragenter."+a.namespace]=function(c){a.onDocumentDragEnter(c)}),typeof a.onDocumentDragLeave==="function"&&(j["dragleave."+a.namespace]=function(c){a.onDocumentDragLeave(c)}),j["dragover."+a.namespace]=i.onDocumentDragOver,
j["drop."+a.namespace]=i.onDocumentDrop,f(document).bind(j),typeof a.onDragEnter==="function"&&(l["dragenter."+a.namespace]=function(c){a.onDragEnter(c)}),typeof a.onDragLeave==="function"&&(l["dragleave."+a.namespace]=function(c){a.onDragLeave(c)}),l["dragover."+a.namespace]=i.onDragOver,l["drop."+a.namespace]=i.onDrop,a.dropZone.bind(l);k.bind("change."+a.namespace,i.onChange)},m=function(){f.each(j,function(c,g){f(document).unbind(c,g)});f.each(l,function(c,g){a.dropZone.unbind(c,g)});k.unbind("change."+
a.namespace)},n=function(c,g,o,h){if(typeof h.onProgress==="function")o.upload.onprogress=function(a){h.onProgress(a,c,g,o,h)};if(typeof h.onLoad==="function")o.onload=function(a){h.onLoad(a,c,g,o,h)};if(typeof h.onAbort==="function")o.onabort=function(a){h.onAbort(a,c,g,o,h)};if(typeof h.onError==="function")o.onerror=function(a){h.onError(a,c,g,o,h)}},v=function(c){if(typeof c.url==="function")return c.url(c.uploadForm||b);return c.url},w=function(c){if(typeof c.method==="function")return c.method(c.uploadForm||
b);return c.method},r=function(c){if(typeof c.fieldName==="function")return c.fieldName(c.fileInput||k);return c.fieldName},s=function(c){var g;if(typeof c.formData==="function")return c.formData(c.uploadForm||b);else if(f.isArray(c.formData))return c.formData;else if(c.formData)return g=[],f.each(c.formData,function(c,a){g.push({name:c,value:a})}),g;return[]},D=function(c,g,a){if(a)c.setRequestHeader("X-Requested-With","XMLHttpRequest");else if(g.withCredentials)c.withCredentials=!0;f.isArray(g.requestHeaders)?
f.each(g.requestHeaders,function(g,a){c.setRequestHeader(a[0],a[1])}):g.requestHeaders&&f.each(g.requestHeaders,function(g,a){c.setRequestHeader(g,a)})},E=function(c,g,a){var h=new FormData,d;f.each(s(a),function(c,g){h.append(g.name,g.value)});for(d=0;d<c.length;d+=1)h.append(r(a),c[d]);g.send(h)},F=function(c,g){var a=new FileReader;a.onload=function(a){c.content=a.target.result;g()};a.readAsBinaryString(c)},G=function(c,a,o,h){var d="";f.each(h,function(a,g){d+="--"+c+'Content-Disposition: form-data; name="'+
unescape(encodeURIComponent(g.name))+'"'+unescape(encodeURIComponent(g.value))});f.each(a,function(a,g){d+="--"+c+'Content-Disposition: form-data; name="'+unescape(encodeURIComponent(o))+'"; filename="'+unescape(encodeURIComponent(g.name))+'"Content-Type: '+g.type+g.content});d+="--"+c+"--\r\n";return d},H=function(c,a,d){var h="----MultiPartFormBoundary"+(new Date).getTime(),f,b;a.setRequestHeader("Content-Type","multipart/form-data; boundary="+h);f=new p(function(){a.sendAsBinary(G(h,c,r(d),s(d)))},
c.length);for(b=0;b<c.length;b+=1)F(c[b],f.complete)},x=function(c,a,d,h){var b=v(h),e;if(C.test(b)){var j=location.host;e=location.protocol.length+2;var l=b.indexOf(j,e),j=l+j.length;e=(l===e||l===b.indexOf("@",e)+1)&&(b.length===j||f.inArray(b.charAt(j),["/","?","#"])!==-1)?!0:!1}else e=!0;n(c,a,d,h);d.open(w(h),b,!0);D(d,h,e);h.multipart?(c=typeof a==="number"?[c[a]]:c,typeof FormData!=="undefined"?E(c,d,h):typeof FileReader!=="undefined"?H(c,d,h):f.error("Browser does neither support FormData nor FileReader interface")):
(h=c[a],e&&d.setRequestHeader("X-File-Name",unescape(encodeURIComponent(h.name))),d.setRequestHeader("Content-Type",h.type),d.send(h))},y=function(c,g,d,b,e){var j=new XMLHttpRequest,l=f.extend({},a);l.fileInput=d;l.uploadForm=b;typeof l.initUpload==="function"?l.initUpload(c,g,e,j,l,function(){x(g,e,j,l)}):x(g,e,j,l)},z=function(c,g,d,b){var e;if(a.multiFileRequest)y(c,g,d,b);else for(e=0;e<g.length;e+=1)y(c,g,d,b,e)},I=function(c,a,d){var b=s(d);a.find(":input").not(":disabled").attr("disabled",
!0).addClass(d.namespace+"_disabled");f.each(b,function(c,b){f('<input type="hidden"/>').attr("name",b.name).val(b.value).addClass(d.namespace+"_form_data").appendTo(a)});c.attr("name",r(d)).appendTo(a)},J=function(c,a,d){c.detach();a.find("."+d.namespace+"_disabled").removeAttr("disabled").removeClass(d.namespace+"_disabled");a.find("."+d.namespace+"_form_data").remove()},A=function(c,a,d,b){var e=a.attr("action"),j=a.attr("method"),l=a.attr("target");d.unbind("abort").bind("abort",function(a){d.readyState=
0;d.unbind("load").attr("src","javascript".concat(":false;"));if(typeof b.onAbort==="function")b.onAbort(a,[{name:c.val(),type:null,size:null}],0,d,b)}).unbind("load").bind("load",function(e){d.readyState=4;if(typeof b.onLoad==="function")b.onLoad(e,[{name:c.val(),type:null,size:null}],0,d,b);f('<iframe src="javascript:false;" style="display:none"></iframe>').appendTo(a).remove()});a.attr("action",v(b)).attr("method",w(b)).attr("target",d.attr("name"));I(c,a,b);d.readyState=2;a.get(0).submit();J(c,
a,b);a.attr("action",e).attr("method",j).attr("target",l)},K=function(c,d,b){var e=f('<iframe src="javascript:false;" style="display:none" name="iframe_'+a.namespace+"_"+(new Date).getTime()+'"></iframe>'),j=f.extend({},a);j.fileInput=d;j.uploadForm=b;e.readyState=0;e.abort=function(){e.trigger("abort")};e.bind("load",function(){e.unbind("load");typeof j.initUpload==="function"?j.initUpload(c,[{name:d.val(),type:null,size:null}],0,e,j,function(){A(d,b,e,j)}):A(d,b,e,j)}).appendTo(b)},B=function(){b=
(e.is("form")?e:e.find("form")).filter(a.uploadFormFilter)},t=function(){k=b.find("input:file").filter(a.fileInputFilter)};this.onDocumentDragOver=function(c){if(typeof a.onDocumentDragOver==="function"&&a.onDocumentDragOver(c)===!1)return!1;c.preventDefault()};this.onDocumentDrop=function(c){if(typeof a.onDocumentDrop==="function"&&a.onDocumentDrop(c)===!1)return!1;c.preventDefault()};this.onDragOver=function(c){if(typeof a.onDragOver==="function"&&a.onDragOver(c)===!1)return!1;var d=c.originalEvent.dataTransfer;
if(d&&d.files)d.dropEffect=d.effectAllowed="copy",c.preventDefault()};this.onDrop=function(c){if(typeof a.onDrop==="function"&&a.onDrop(c)===!1)return!1;var b=c.originalEvent.dataTransfer;b&&b.files&&d()&&z(c,b.files);c.preventDefault()};this.onChange=function(c){if(typeof a.onChange==="function"&&a.onChange(c)===!1)return!1;var b=f(c.target),e=f(c.target.form);if(e.length===1){b.data("file_upload_form",e);var j=b.clone(!0);f("<form/>").append(j).get(0).reset();b.after(j).detach();t()}else e=b.data("file_upload_form");
!a.forceIframeUpload&&c.target.files&&d()?z(c,c.target.files,b,e):K(c,b,e)};this.init=function(c){c&&(f.extend(a,c),q=c);B();t();e.data(a.namespace)?f.error('FileUpload with namespace "'+a.namespace+'" already assigned to this element'):(e.data(a.namespace,i).addClass(a.cssClass),a.dropZone.not(e).addClass(a.cssClass),u())};this.options=function(c){var d,b,j,l;if(typeof c==="undefined")return f.extend({},a);q&&f.extend(q,c);m();f.each(c,function(c,e){switch(c){case "namespace":f.error("The FileUpload namespace cannot be updated.");
return;case "uploadFormFilter":l=j=!0;break;case "fileInputFilter":l=!0;break;case "cssClass":d=a.cssClass;break;case "dropZone":b=a.dropZone}a[c]=e});j&&B();l&&t();typeof d!=="undefined"?(e.removeClass(d).addClass(a.cssClass),(b?b:a.dropZone).not(e).removeClass(d),a.dropZone.not(e).addClass(a.cssClass)):b&&(b.not(e).removeClass(a.cssClass),a.dropZone.not(e).addClass(a.cssClass));u()};this.option=function(c,d){var b;if(typeof d==="undefined")return a[c];b={};b[c]=d;i.options(b)};this.destroy=function(){m();
e.removeData(a.namespace).removeClass(a.cssClass);a.dropZone.not(e).removeClass(a.cssClass)}};m={init:function(e){return this.each(function(){(new n(f(this))).init(e)})},option:function(e,i,b){var b=b?b:"file_upload",k=f(this).data(b);if(k){if(typeof e==="string")return k.option(e,i);return k.options(e)}else f.error('No FileUpload with namespace "'+b+'" assigned to this element')},destroy:function(e){e=e?e:"file_upload";return this.each(function(){var i=f(this).data(e);i?i.destroy():f.error('No FileUpload with namespace "'+
e+'" assigned to this element')})}};f.fn.fileUpload=function(e){if(m[e])return m[e].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof e==="object"||!e)return m.init.apply(this,arguments);else f.error("Method "+e+" does not exist on jQuery.fileUpload")}})(jQuery);
(function(f){var n,m,p=function(e,f){var b,k;if(!f.test(e.type))return null;b=document.createElement("img");if(typeof URL!=="undefined"&&typeof URL.createObjectURL==="function")return b.src=URL.createObjectURL(e),b.onload=function(){URL.revokeObjectURL(this.src)},b;if(typeof FileReader!=="undefined"&&(k=new FileReader,typeof k.readAsDataURL==="function"))return k.onload=function(a){b.src=a.target.result},k.readAsDataURL(e),b;return null};n=function(e,i){var b=this,k,a;this.dropZone=e;this.imageTypes=
/^image\/(gif|jpeg|png)$/;this.previewSelector=".file_upload_preview";this.progressSelector=".file_upload_progress div";this.cancelSelector=".file_upload_cancel button";this.cssClassSmall="file_upload_small";this.cssClassLarge="file_upload_large";this.cssClassHighlight="file_upload_highlight";this.dropEffect="highlight";this.uploadTable=this.downloadTable=null;this.buildUploadRow=this.buildDownloadRow=function(){return null};this.addNode=function(a,b,e){b?b.css("display","none").appendTo(a).fadeIn(function(){if(typeof e===
"function")try{e()}catch(a){throw f(this).stop(),a;}}):typeof e==="function"&&e()};this.removeNode=function(a,b){a?a.fadeOut(function(){f(this).remove();if(typeof b==="function")try{b()}catch(a){throw f(this).stop(),a;}}):typeof b==="function"&&b()};this.onAbort=function(a,b,e,f,d){d.removeNode(d.uploadRow)};this.cancelUpload=function(a,b,e,f,d){var i=f.readyState;f.abort();if(isNaN(i)||i<2)d.onAbort(a,b,e,f,d)};this.initProgressBar=function(a,b){if(typeof a.progressbar==="function")return a.progressbar({value:b});
else{var e=f('<progress value="'+b+'" max="100"/>').appendTo(a);e.progressbar=function(a,b){e.attr("value",b)};return e}};this.initUploadRow=function(a,b,e,i,d,k){if(a=d.uploadRow=d.buildUploadRow(b,e,d))d.progressbar=d.initProgressBar(a.find(d.progressSelector),0),a.find(d.cancelSelector).click(function(a){d.cancelUpload(a,b,e,i,d)}),a.find(d.previewSelector).each(function(){f(this).append(new p(b[e],d.imageTypes))});d.addNode(typeof d.uploadTable==="function"?d.uploadTable(d):d.uploadTable,a,k)};
this.initUploadProgress=function(a,b){a.upload||b.progressbar.progressbar("value",100)};this.initUpload=function(a,b,e,f,d,i){d.initUploadRow(a,b,e,f,d,function(){typeof d.beforeSend==="function"?d.beforeSend(a,b,e,f,d,function(){d.initUploadProgress(f,d);i()}):(d.initUploadProgress(f,d),i())})};this.onProgress=function(a,b,e,f,d){d.progressbar&&d.progressbar.progressbar("value",parseInt(a.loaded/a.total*100,10))};this.parseResponse=function(a){return typeof a.responseText!=="undefined"?f.parseJSON(a.responseText):
f.parseJSON(a.contents().text())};this.initDownloadRow=function(a,b,e,f,d,i){var k,m;try{k=d.response=d.parseResponse(f),m=d.downloadRow=d.buildDownloadRow(k,d),d.addNode(typeof d.downloadTable==="function"?d.downloadTable(d):d.downloadTable,m,i)}catch(n){if(typeof d.onError==="function")d.originalEvent=a,d.onError(n,b,e,f,d);else throw n;}};this.onLoad=function(a,b,e,i,d){f("#form_container").html(i.responseText);f("#magic").html('<form id="submit_upload" class="file_upload blue" action="/file_upload" method="POST" enctype="multipart/form-data"><button>Go</button><div id="upload_button">Go</div></form>');
d.removeNode(d.uploadRow,function(){})};this.dropZoneEnlarge=function(){a||(typeof b.dropZone.switchClass==="function"?b.dropZone.switchClass(b.cssClassSmall,b.cssClassLarge):(b.dropZone.addClass(b.cssClassLarge),b.dropZone.removeClass(b.cssClassSmall)),a=!0)};this.dropZoneReduce=function(){typeof b.dropZone.switchClass==="function"?b.dropZone.switchClass(b.cssClassLarge,b.cssClassSmall):(b.dropZone.addClass(b.cssClassSmall),b.dropZone.removeClass(b.cssClassLarge));a=!1};this.onDocumentDragEnter=
function(){b.dropZoneEnlarge()};this.onDocumentDragOver=function(){k&&clearTimeout(k);k=setTimeout(function(){b.dropZoneReduce()},200)};this.onDragEnter=this.onDragLeave=function(){b.dropZone.toggleClass(b.cssClassHighlight)};this.onDrop=function(){k&&clearTimeout(k);b.dropEffect&&typeof b.dropZone.effect==="function"?b.dropZone.effect(b.dropEffect,function(){b.dropZone.removeClass(b.cssClassHighlight);b.dropZoneReduce()}):(b.dropZone.removeClass(b.cssClassHighlight),b.dropZoneReduce())};f.extend(this,
i)};m={init:function(e){return this.each(function(){f(this).fileUpload(new n(f(this),e))})},option:function(e,i,b){if(typeof e==="undefined"||typeof e==="string"&&typeof i==="undefined")return f(this).fileUpload("option",e,i,b);return this.each(function(){f(this).fileUpload("option",e,i,b)})},destroy:function(e){return this.each(function(){f(this).fileUpload("destroy",e)})}};f.fn.fileUploadUI=function(e){if(m[e])return m[e].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof e==="object"||
!e)return m.init.apply(this,arguments);else f.error("Method "+e+" does not exist on jQuery.fileUploadUI")}})(jQuery);$("#file_upload").fileUploadUI({uploadTable:$("#files"),downloadTable:$("#files")});var editor=CodeMirror.fromTextArea(document.getElementById("codebox"),{lineNumbers:!0,onKeyEvent:textChanged});
function textChanged(f){f.getValue()!==""&&$("#upload_button").text()==="Upload"&&$("#magic").html('<form id="submit_upload" class="file_upload blue" action="/file_upload" method="POST" enctype="multipart/form-data"><button>Go</button><div id="upload_button">Go</div></form>');f.getValue()===""&&$("#upload_button").text()==="Go"&&$("#magic").html('<form id="file_upload" class="file_upload blue" action="/file_upload" method="POST" enctype="multipart/form-data"> <input type="file" name="file" multiple><button>Upload</button><div id="upload_button">Upload</div>{{ xsrf_form_html() }}</form>')}
$("#submit_upload").live("click",function(){$.post("/paste",{body:editor.getValue(),name:$("#uploaded_file_name").val()},function(f){document.location="{{ SITE_ROOT }}/"+f})});</script>{% end %}
